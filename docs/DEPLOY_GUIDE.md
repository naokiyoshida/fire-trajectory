# Google Apps Script デプロイガイド

このドキュメントは、Google Apps Script (GAS) のウェブアプリを**同じURLのまま**更新する方法について説明します。

---

## 概要

GASのウェブアプリを更新する際、「新しいデプロイ」を作成すると、その都度新しいURLが発行されてしまいます。
UserScript (`mf_sync_client.user.js`) など、外部からURLを固定して呼び出している場合は、これでは不都合です。

URLを変更せずにコードのみを更新するには、**既存のデプロイを管理**機能を使用します。

---

## 方法1：GASエディタで手動更新する

GUI（グラフィカル・ユーザー・インターフェース）を使って手動で更新する方法です。

1.  ブラウザで対象のGoogleスプレッドシートを開き、メニューから **[拡張機能] > [Apps Script]** を選択してGASエディタを開きます。

2.  コードを編集し、**フロッピーディスクアイコン（プロジェクトを保存）** をクリックして変更を保存します。

3.  画面右上の **[デプロイ]** ボタンをクリックし、ドロップダウンメニューから **[デプロイを管理]** を選択します。

4.  現在有効なデプロイが表示されます。更新したいデプロイ（通常は一つです）の **編集アイコン（鉛筆マーク）** をクリックします。

5.  ダイアログが表示されたら、「バージョン」の項目で **「新バージョン」** を選択します。

6.  最後に **[デプロイ]** ボタンをクリックします。

これで、公開URLを変更することなく、ウェブアプリが最新のコードに更新されました。

---

## 方法2：`clasp` CLIツールで更新する（推奨）

`clasp` は、Google公式のGASプロジェクト用コマンドラインツールです。導入すれば、コマンド一つでデプロイ作業が完了します。

### 1. 変更をアップロード

ローカルで編集したコードを `clasp` を使ってGoogleのサーバーにアップロードします。

```shell
# src/gas_receiver_service.gs ファイルをサーバーに反映
clasp push
```

### 2. 既存のデプロイを更新

以下のコマンドを実行して、既存のデプロイを更新します。

```shell
# デプロイを更新（URLは変更されません）
clasp deploy
```

`clasp` は、一度 `deploy` を実行するとプロジェクト内にデプロイIDを記憶します。2回目以降の `clasp deploy` は、その記憶されたIDに対して更新を行うため、自動的にURLが変わらない仕組みになっています。